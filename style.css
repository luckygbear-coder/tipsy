:root{
  --bg:#ffeec9;
  --card:#fff7e6;
  --border:#e1b676;
  --shadow:rgba(0,0,0,.14);
  --text:#4b3044;
  --muted:#7a5a6a;
  --btn:#ffcc6a;
  --btn2:#ffdca0;
  --pink1:#ffd1f0;
  --pink2:#ffe6fa;
  --mask:rgba(0,0,0,.35);
}

*{box-sizing:border-box}
html,body{height:100%}

body{
  margin:0;
  background:var(--bg);
  font-family:"Noto Sans TC",-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  color:var(--text);
  overflow:auto; /* ✅ 不要鎖死，不然 iPhone 很容易怪 */
}

.app{
  min-height:100dvh;
  display:flex;
  flex-direction:column;
}

.header{padding:14px 14px 10px;}

.topbar{
  display:flex; gap:12px; align-items:center;
  padding:14px; border:2px solid var(--border);
  background:linear-gradient(180deg,#fff3d8,#fff7e6);
  border-radius:18px; box-shadow:0 8px 20px var(--shadow);
}
.logo{
  width:56px;height:56px;border-radius:16px;
  border:2px solid var(--border);
  background:#fff; overflow:hidden; flex:0 0 auto;
  display:flex; align-items:center; justify-content:center;
}
.logo img{width:100%;height:100%;object-fit:cover}
.title{flex:1;min-width:0}
.title h1{margin:0;font-size:18px;letter-spacing:.4px}
.title p{margin:6px 0 0; color:var(--muted); font-size:13px; line-height:1.35}

/* ✅ 主內容 */
.main{
  flex:1;
  min-height:0;
  overflow:auto;
  -webkit-overflow-scrolling: touch;
  padding:0 14px 18px;
  display:flex;
  flex-direction:column;
  gap:12px;
}

/* ====== 最上方 IG 主題按鈕 ====== */
.top-ig-btn{
  display:flex; align-items:center; gap:12px;
  padding:12px 14px;
  border-radius:18px;
  background:#fff7e6;
  border:2px solid var(--border);
  box-shadow:0 8px 18px rgba(0,0,0,0.10);
  text-decoration:none;
  color:var(--text);
}
.top-ig-icon{
  width:46px; height:46px; border-radius:12px; object-fit:cover;
  border:2px solid rgba(225,182,118,.7);
  background:#fff;
}
.top-ig-text{ flex:1; min-width:0; }
.top-ig-title{ font-weight:900; font-size:16px; letter-spacing:.5px; }
.top-ig-sub{ font-size:12px; color:var(--muted); margin-top:2px; }
.top-ig-arrow{ font-size:22px; opacity:.55; }

/* ====== 熊主視覺（新版） ====== */
.hero-card{ margin-top:4px; }

.hero-media{
  position:relative;
  border-radius:22px;
  overflow:hidden;
  border:2px solid var(--border);
  box-shadow:0 10px 24px var(--shadow);
  background:#fff;
  min-height:260px; /* ✅ 圖片還沒載入也不會塌 */
  cursor:pointer;
  user-select:none;
  -webkit-touch-callout:none;
}

.hero-img{
  width:100%;
  height:auto;
  display:block;
  object-fit:cover;
  -webkit-user-drag:none;
}

/* ✅ 氣泡在熊頭上（縮小版，不遮住熊） */
.comic-bubble.over-bear{
  position:absolute;
  left:14px;
  right:14px;
  top:12px;
  z-index:5;

  background:#fff;
  border:2px solid var(--border);
  border-radius:16px;
  padding:8px 10px;
  box-shadow:0 8px 18px rgba(0,0,0,0.16);

  font-size:13px;
  line-height:1.35;

  /* ✅ 讓它變小：最多 3 行 */
  max-width:78%;
  white-space:normal;
  overflow:hidden;
  text-overflow:ellipsis;

  display:-webkit-box;
  -webkit-line-clamp:3;
  -webkit-box-orient:vertical;
}

/* 尾巴：指向熊頭（位置微調） */
.comic-bubble.over-bear::before{
  content:"";
  position:absolute;
  left:22px;
  bottom:-10px;
  width:0;height:0;
  border-left:10px solid transparent;
  border-right:10px solid transparent;
  border-top:10px solid var(--border);
}
.comic-bubble.over-bear::after{
  content:"";
  position:absolute;
  left:22px;
  bottom:-8px;
  width:0;height:0;
  border-left:9px solid transparent;
  border-right:9px solid transparent;
  border-top:9px solid #fff;
}

/* ✅ 右下角提示 */
.hero-hint{
  position:absolute;
  right:12px;
  bottom:12px;
  z-index:6;
  background:rgba(255,255,255,.86);
  border:1px dashed rgba(225,182,118,.9);
  padding:6px 10px;
  border-radius:14px;
  font-size:12px;
  color:#6a4b5a;
}

/* ====== 按鈕 ====== */
.row2{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.btn{
  appearance:none; border:none; cursor:pointer;
  background:linear-gradient(180deg,var(--btn),var(--btn2));
  border:2px solid var(--border);
  border-radius:16px;
  padding:12px 10px;
  font-size:14px;
  color:var(--text);
  box-shadow:0 6px 14px rgba(0,0,0,.10);
  display:flex; align-items:center; justify-content:center;
  gap:8px;
  user-select:none;
  transition:transform .08s ease, filter .15s ease;
}
.btn:active{transform:translateY(1px) scale(.99)}
.btn.secondary{background:#fff;}
.btn.small{padding:10px 10px; font-size:13px; border-radius:14px;}

/* ====== 心情 ====== */
.moodWrap{display:flex;gap:10px;align-items:flex-start;justify-content:space-between;}
.moods{display:flex; gap:8px; align-items:center; flex-wrap:wrap;}
.mood-btn{
  border:none; cursor:pointer;
  background:#fff;
  border:2px solid var(--border);
  border-radius:999px;
  padding:8px 10px;
  font-size:13px;
  box-shadow:0 4px 10px rgba(0,0,0,.08);
  color:var(--text);
  user-select:none;
}
.mood-btn.active{background:linear-gradient(180deg,#fff0c8,#fff7e6);}
.mood-pill{
  font-size:12px;color:var(--muted);
  background:#fff; border:1px dashed var(--border);
  padding:6px 10px;border-radius:999px;
  white-space:nowrap;
}

/* ====== Toast ====== */
.toast{
  position:fixed; left:50%; bottom:14px;
  transform:translateX(-50%);
  background:rgba(75,48,68,.92);
  color:#fff;
  padding:10px 12px;
  border-radius:999px;
  font-size:13px;
  opacity:0; pointer-events:none;
  transition:opacity .18s ease;
  max-width:92vw;
  text-align:center;
  z-index:92;
}
.toast.show{opacity:1}

/* ====== Modal ====== */
.modal-mask{
  position:fixed; inset:0;
  background:var(--mask);
  display:none;
  align-items:flex-end;
}
.modal-mask.show{display:flex;}

.modal{
  width:100%;
  max-width:480px;
  margin:0 auto;
  background:#fff;
  border:2px solid var(--border);
  border-bottom:none;
  border-radius:18px 18px 0 0;
  box-shadow:0 -12px 30px rgba(0,0,0,.22);
  padding:14px;
  max-height: 88dvh;
  overflow:hidden;
}

.modal-head{
  display:flex; align-items:center; justify-content:space-between; gap:10px;
  margin-bottom:10px;
}
.modal-head h3{margin:0;font-size:16px}
.xbtn{
  border:none; cursor:pointer;
  background:#fff;
  border:2px solid var(--border);
  border-radius:12px;
  padding:8px 10px;
  font-size:13px;
  box-shadow:0 4px 10px rgba(0,0,0,.08);
  user-select:none;
}

.content{
  overflow:auto;
  max-height:58dvh;
  padding-right:4px;
  margin-top:10px;
  -webkit-overflow-scrolling: touch;
}

.block{margin-top:10px}
.label{font-size:12px;color:var(--muted);margin-bottom:4px}
.text{
  background:#fff7e6;
  border:1px solid rgba(225,182,118,.65);
  border-radius:12px;
  padding:10px;
  line-height:1.55;
  font-size:13px;
  white-space:pre-wrap;
}
.warn{background:#fff1f1;border:1px solid rgba(176,71,71,.35);color:#6a2b2b;}

.smallnote{
  margin-top:10px;
  color:var(--muted);
  font-size:12px;
  line-height:1.5;
  text-align:center;
}

/* Tabs / filters / list */
.tabs{display:flex; gap:8px; margin:10px 0;}
.tab{
  flex:1;
  border:none; cursor:pointer;
  background:#fff;
  border:2px solid var(--border);
  border-radius:999px;
  padding:9px 10px;
  font-size:13px;
  box-shadow:0 4px 10px rgba(0,0,0,.08);
}
.tab.active{background:linear-gradient(180deg,#fff0c8,#fff7e6);}

.filters{display:flex;gap:8px;flex-wrap:wrap;margin:6px 0 10px;}
.filter-btn{
  border:none; cursor:pointer;
  background:#fff;
  border:2px solid rgba(225,182,118,.7);
  border-radius:999px;
  padding:7px 10px;
  font-size:12px;
  box-shadow:0 3px 8px rgba(0,0,0,.07);
}
.filter-btn.active{background:linear-gradient(180deg,#fff0c8,#fff7e6);}

.search{display:flex; gap:8px; align-items:center; margin:6px 0 10px;}
.search input{
  flex:1;
  border:2px solid rgba(225,182,118,.7);
  border-radius:14px;
  padding:10px 12px;
  font-size:16px;
  outline:none;
  background:#fff;
}

.item{
  border:2px solid rgba(225,182,118,.55);
  border-radius:14px;
  padding:10px;
  margin-bottom:10px;
  background:#fff7e6;
}
.item-top{display:flex; gap:10px; align-items:flex-start;}
.item-emoji{
  width:38px;height:38px;border-radius:12px;
  border:2px solid var(--border);
  background:#fff;
  display:flex;align-items:center;justify-content:center;
  font-size:20px;
}
.item h5{margin:0;font-size:14px}
.item .meta{margin-top:4px;font-size:12px;color:var(--muted);line-height:1.35}
.item-actions{display:flex; gap:8px; margin-top:10px; flex-wrap:wrap;}

/* ====== 派對小遊戲 ====== */
.party-wrap{
  background:var(--card);
  border:2px solid var(--border);
  border-radius:18px;
  box-shadow:0 8px 18px rgba(0,0,0,.10);
  padding:12px;
}
.party-title{font-size:14px;font-weight:700;margin-bottom:8px;}
.party-note{margin-top:8px;font-size:12px;color:var(--muted);text-align:center;line-height:1.4;}
.party-grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;}

.party-task{ margin-top:10px; }
.party-type{
  display:inline-block;
  font-size:12px;
  color:var(--muted);
  border:1px dashed var(--border);
  border-radius:999px;
  padding:6px 10px;
  background:#fff;
}
.party-card{
  margin-top:10px;
  background:#fff7e6;
  border:2px solid rgba(225,182,118,.65);
  border-radius:16px;
  padding:14px 12px;
  font-size:15px;
  line-height:1.6;
  box-shadow:0 6px 14px rgba(0,0,0,.08);
  white-space:pre-wrap;
}
.party-toggle{
  margin-top:10px;
  background:#fff;
  border:1px dashed var(--border);
  border-radius:14px;
  padding:10px 12px;
}
.toggle{display:flex;align-items:center;gap:10px;user-select:none;cursor:pointer;}
.toggle input{display:none;}
.toggle-ui{
  width:44px;height:26px;border-radius:999px;
  border:2px solid rgba(225,182,118,.8);
  background:#fff7e6;
  position:relative;
  box-shadow:0 4px 10px rgba(0,0,0,.08);
}
.toggle-ui:after{
  content:"";
  position:absolute; top:2px; left:2px;
  width:20px;height:20px;border-radius:999px;
  background:#fff;
  border:2px solid rgba(225,182,118,.8);
  transition:transform .18s ease;
}
.toggle input:checked + .toggle-ui:after{transform:translateX(18px);}
.toggle-text{font-size:13px;color:var(--text);line-height:1.3;}

/* Loading */
.loading{
  position:fixed; inset:0;
  background:rgba(255,238,201,.85);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:95;
  backdrop-filter: blur(2px);
}
.loading.show{display:flex;}
.load-card{
  width:min(360px, 92vw);
  background:#fff;
  border:2px solid var(--border);
  border-radius:18px;
  box-shadow:0 12px 30px rgba(0,0,0,.18);
  padding:14px;
  text-align:center;
}
.load-bear{
  width:84px;height:84px;border-radius:24px;
  border:2px solid var(--border);
  overflow:hidden;
  margin:0 auto 10px;
  background:#fff;
  animation:bob 1.1s ease-in-out infinite;
}
/* =========================
   ✅ 修正：派對小遊戲 Modal 太大 & 看不到內容
   只影響 #partyMask
   ========================= */

/* 1) 派對視窗不要貼底，改置中 + 可滾動 */
#partyMask.modal-mask{
  align-items: center;     /* 覆蓋原本 flex-end */
  justify-content: center;
  padding: 14px;
}

/* 2) 派對 modal 限高、整個 modal 可捲動（因為派對內容不在 .content） */
#partyMask .modal{
  width: min(520px, 100%);
  max-height: 92dvh;
  overflow: auto;          /* ✅ 關鍵：派對內容直接讓 modal 捲動 */
  -webkit-overflow-scrolling: touch;

  border-radius: 18px;     /* 置中時比較好看 */
  border-bottom: 2px solid var(--border); /* 因為不貼底了 */
}

/* 3) 補齊派對內部排版，避免元素撐爆 */
#partyMask .chat-row{
  display: flex;
  gap: 10px;
  align-items: flex-start;
}

#partyMask .avatar{
  width: 52px;
  height: 52px;
  border-radius: 16px;
  border: 2px solid var(--border);
  overflow: hidden;
  background: #fff;
  flex: 0 0 auto;
}

#partyMask .avatar img{
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

#partyMask .bubble{
  background: #fff;
  border: 2px solid var(--border);
  border-radius: 16px;
  padding: 10px 12px;
  box-shadow: 0 6px 14px rgba(0,0,0,.10);
  font-size: 13px;
  line-height: 1.45;
}

#partyMask .bubble-tip{
  margin-top: 6px;
  font-size: 12px;
  color: var(--muted);
}

/* 4) 題目卡不要太高（保險） */
#partyMask .party-card{
  max-height: 40dvh;
  overflow: auto;
  -webkit-overflow-scrolling: touch;
}
.load-bear img{width:100%;height:100%;object-fit:cover}
@keyframes bob{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
.dots{display:flex; gap:6px; justify-content:center; margin-top:10px;}
.dot{width:8px;height:8px;border-radius:999px;background:rgba(75,48,68,.7);animation:blink 1s infinite ease-in-out;}
.dot:nth-child(2){animation-delay:.15s}
.dot:nth-child(3){animation-delay:.3s}
@keyframes blink{0%,100%{transform:translateY(0);opacity:.35}50%{transform:translateY(-6px);opacity:1}}

/* ✅ 疊層保險（視窗不會被蓋住） */
#listMask{ z-index:80; }
#drinkMask{ z-index:90; }
#partyMask{ z-index:96; }
#toast{ z-index:97; }
#loading{ z-index:98; }